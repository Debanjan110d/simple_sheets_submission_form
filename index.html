<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Contact Form</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">Contact<span>Form</span></div>
            <div class="theme-toggle">
                <button type="button" class="theme-switch-btn" id="theme-toggle" title="Toggle Theme">
                    <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <form id="contact-form" method="POST" action="YOUR_SHEET_URL" target="hidden_iframe">

            <h2>Contact Us</h2>
            <p id="status-message"></p>

            <div class="form-group">
                <label for="name">Name:</label>
                <input id="name" name="name" type="text" required placeholder="Enter your name" />
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input id="email" name="email" type="email" required placeholder="your@email.com" />
            </div>

            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input id="phone" name="phone" type="tel" required placeholder="+1 (555) 123-4567" />
            </div>

            <div class="form-group">
                <label for="address">Address:</label>
                <textarea id="address" name="address" rows="3" required
                    placeholder="Enter your full address"></textarea>
            </div>

            <button type="submit" id="submit-btn">Send Message</button>
        </form>
    </div>

    <!-- Hidden iframe receives the POST response from Apps Script -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

    <script>
        const form = document.getElementById('contact-form');
        const submitButton = document.getElementById('submit-btn');
        const statusMessage = document.getElementById('status-message');
        const hiddenIframe = document.getElementById('hidden_iframe');

        let received = false;
        let formSubmitted = false;

        // Theme Switcher
        const themeToggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';

        // Apply saved theme on load
        document.documentElement.setAttribute('data-theme', currentTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // When user submits: show sending state
        form.addEventListener('submit', () => {
            formSubmitted = true;
            received = false;
            submitButton.disabled = true;
            statusMessage.textContent = 'Sending, please wait...';
            statusMessage.className = '';
        });

        // Listen for message events from the iframe (Apps Script response uses postMessage)
        window.addEventListener('message', (ev) => {
            // Optionally check ev.origin if you want to restrict the sender
            const data = ev.data || {};

            if (data.result === 'success') {
                received = true;
                statusMessage.textContent = 'Message sent successfully!';
                statusMessage.className = 'success';
                form.reset();
                submitButton.disabled = false;
                formSubmitted = false;
            } else if (data.result === 'error') {
                received = true;
                statusMessage.textContent = 'Error: ' + (data.message || 'Unknown error');
                statusMessage.className = 'error';
                submitButton.disabled = false;
                formSubmitted = false;
            }
        }, false);

        // Fallback: Listen to iframe load event (when Apps Script responds)
        hiddenIframe.addEventListener('load', () => {
            // Only trigger if form was just submitted and no postMessage received yet
            if (formSubmitted && !received) {
                // Small delay to allow postMessage to arrive first
                setTimeout(() => {
                    if (formSubmitted && !received) {
                        received = true;
                        formSubmitted = false;
                        statusMessage.textContent = 'Message sent successfully!';
                        statusMessage.className = 'success';
                        form.reset();
                        submitButton.disabled = false;
                    }
                }, 500);
            }
        });

        // Final fallback: if we don't get any response within X seconds, re-enable UI
        let timeoutId;
        form.addEventListener('submit', () => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
                if (formSubmitted && !received) {
                    submitButton.disabled = false;
                    statusMessage.textContent = 'No response from server. Please try again.';
                    statusMessage.className = 'error';
                    formSubmitted = false;
                }
            }, 12000);
        });
    </script>

</body>

</html>